<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Landing - Forty by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
				<!-- Note: The "styleN" class below should match that of the banner element. -->
					<header id="header" class="alt style2">
						<a href="index.html" class="logo"><strong>Forty</strong> <span>by HTML5 UP</span></a>
						<nav>
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
							<li><a href="index.html">Home</a></li>
							<li><a href="landing.html">Landing</a></li>
							<li><a href="generic.html">Generic</a></li>
							<li><a href="elements.html">Elements</a></li>
						</ul>
						<ul class="actions stacked">
							<li><a href="#" class="button primary fit">Get Started</a></li>
							<li><a href="#" class="button fit">Log In</a></li>
						</ul>
					</nav>

				<!-- Banner -->
				<!-- Note: The "styleN" class below should match that of the header element. -->
					<section id="banner" class="style2">
						<div class="inner">
							<span class="image">
								<img src="images/pic07.jpg" alt="" />
							</span>
							<header class="major">
								<h1>Hexacopter ROS 2 Program</h1>
							</header>
							<div class="content">
								<p>Lorem ipsum dolor sit amet nullam consequat<br />
								sed veroeros. tempus adipiscing nulla.</p>
							</div>
						</div>
					</section>

				<!-- Main -->
					<div id="main">

						<!-- One -->
							<section id="one">
								<div class="inner">
									<header class="major">
										<h2>Methodology</h2>
									</header>
									<p>Talk about all the code you made.</p>
								</div>
							</section>

						<!-- Two -->
							<section id="two" class="spotlights">

								<!-- Spoofer -->
								<section>
									<a href="generic.html" class="image">
										<img src="images/project_imgs/hexacopter/spoofer_exp_filt_zoom.png" alt="" data-position="center center" />
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>Data Spoofers</h3>
											</header>
											<p>Created data spoofer for wrench data with simulated noise of FT-300 Sensor.</p>
                                            <ul class="actions">
												<a href="#" class="button show-code-btn" data-target="codeModal1a">Spoofer Pub Code</a>
												<p>_________</p>
												<a href="#" class="button show-code-btn" data-target="codeModal1b">Spoofer Logger Code</a>
											</ul>
										</div>
									</div>
								</section>

								<!-- Data Filters -->
								<section>
									<a href="generic.html" class="image">
										<img src="images/project_imgs/hexacopter/spoofer_lowpass_filt_zoom.png" alt="" data-position="top center" />
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>Data Filters</h3>
											</header>
											<p>After testing exponetional and lowpass filters in MATLAB, lowpass filters (Shown filtering spoofer data on the right) were found to be more desirable for this project. A ROS 2 live lowpass filter script was made in python that filtered the raw data being pulled from the FT-300 sensor.</p>
											<ul class="actions">
												<a href="#" class="button show-code-btn" data-target="codeModal2">Live Lowpass Code</a>
											</ul>
										</div>
									</div>
								</section>

								<!-- UR5 Connect -->
								<section>
									<a href="generic.html" class="image">
										<img src="images/project_imgs/hexacopter/plotjuggler_lowpass_test.png" alt="" data-position="top center" />
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>UR5 and FT-300 Data Connect</h3>
											</header>
											<p>Created code to connect UR5e and FT-300 sensor to ROS 2 programs.</p>
											<ul class="actions">
												<a href="#" class="button show-code-btn" data-target="codeModal3">UR5 Connect Code</a>
											</ul>
										</div>
									</div>
								</section>

								<!-- PX4 Control -->
								<section>
									<a href="generic.html" class="image">
										<img src="images/project_imgs/hexacopter/drone_pic_2_cropped.jpg" alt="" data-position="top center" />
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>PX4 Drone Control Program</h3>
											</header>
											<p>Created ROS 2 program node to control PX4 control board on drone to test motors.</p>
											<ul class="actions">
												<a href="#" class="button show-code-btn" data-target="codeModal4">UR5 Connect Code</a>
											</ul>
										</div>
									</div>
								</section>

								<!-- ROS 2 Launchers -->
								<section>
									<a href="generic.html" class="image">
										<img src="images/project_imgs/hexacopter/gazebo_actuator_control.png" alt="" data-position="25% 25%" />
									</a>
									<div class="content">
										<div class="inner">
											<header class="major">
												<h3>ROS 2 Launchers</h3>
											</header>
											<p>Created luanchers that automatically connected to UR5, started, data filters PX4 motor test program, and logged data in a ROS bag.</p>
											<ul class="actions">
												<a href="#" class="button show-code-btn" data-target="codeModal5">UR5 Connect and Filter</a>
												<p>__________</p>
												<a href="#" class="button show-code-btn" data-target="codeModal6">PX4 Control and ROS Bag</a>
											</ul>
										</div>
									</div>
								</section>
							</section>

						<!-- Three -->
							<section id="three">
								<div class="inner">
									<header class="major">
										<h2>Github Repositories</h2>
									</header>
									<p>Here are the repositories for the code mentioned above. The Hex Rotor ROS WS repository has full instructions on installation, setup, and operation.</p>
									<ul class="actions">
										<li><a href="https://github.com/coloms9/ft300_hex_rotor_ros_ws" class="button icon brands fa-github">Hex Rotor ROS WS</a></li>
										<li><a href="https://github.com/coloms9/UR5_FT300_Sensor_ROS2_Code" class="button icon brands fa-github">Spoofer</a></li>
									</ul>
								</div>
							</section>

					</div>

				<!-- Contact -->
					<section id="contact">
						<div class="inner">
							<section>
								<form method="post" action="#">
									<div class="fields">
										<div class="field half">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="6"></textarea>
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Send Message" class="primary" /></li>
										<li><input type="reset" value="Clear" /></li>
									</ul>
								</form>
							</section>
							<section class="split">
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-envelope"></span>
										<h3>Email</h3>
										<a href="#">information@untitled.tld</a>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-phone"></span>
										<h3>Phone</h3>
										<span>(000) 000-0000 x12387</span>
									</div>
								</section>
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-home"></span>
										<h3>Address</h3>
										<span>1234 Somewhere Road #5432<br />
										Nashville, TN 00000<br />
										United States of America</span>
									</div>
								</section>
							</section>
						</div>
					</section>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<ul class="icons">
								<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
								<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								<li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							</ul>
							<ul class="copyright">
								<li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>



			<!-- Show Spoofer PUB Code Button -->
			<div id="codeModal1a" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3
import rclpy
import math
import time
import numpy as np
from rclpy.node import Node
from geometry_msgs.msg import Wrench
from std_msgs.msg import Float64

class SpoofWrenchDataNode(Node):
	def __init__(self):
		super().__init__("spoof_wrench_pub")
		self.wrench_pub_ = self.create_publisher(Wrench, "/spoofer/wrench", 10)
		self.timer = self.create_timer(0.01, self.send_spoof_data)
		self.get_logger().info("Spoof wrench data program started!")

	def send_spoof_data(self):
		msg = Wrench()
		t = time.time()
		fsdxy = np.random.normal(0,1.2)
		fsdz = np.random.normal(0,0.5)
		tsdxy = np.random.normal(0,0.02)
		tsdz = np.random.normal(0,0.03)
		msg.force.x = 10*math.sin(math.pi*t) + fsdxy
		msg.force.y = 10*math.sin(math.pi*t) + fsdxy
		msg.force.z = 10*math.sin(math.pi*t) + fsdxy
		msg.torque.x = 10*math.sin(math.pi*t) + tsdxy
		msg.torque.y = 10*math.sin(math.pi*t) + tsdxy
		msg.torque.z = 10*math.sin(math.pi*t) + tsdz
		self.wrench_pub_.publish(msg)

def main(args=None):
	rclpy.init(args=args)
	node = SpoofWrenchDataNode()
	rclpy.spin(node)
	rclpy.shutdown()</code></pre>
				</div>
			</div>

			<!-- Show Spoofer Logger Code Button -->
			<div id="codeModal1a" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3
import rclpy
import time
from rclpy.node import Node
from geometry_msgs.msg import Wrench

class SpoofWrenchDataLoggerNode(Node):

    msg = Wrench()
    fx1 = msg.force.x
    fy1 = msg.force.y
    fz1 = msg.force.z
    tx1 = msg.torque.x
    ty1 = msg.torque.y
    tz1 = msg.torque.z

    afx1 = 0.5
    afy = 1.0
    afz = 1.0
    atx = 1.0
    aty = 1.0
    atz = 1.0

    def __init__(self):
        super().__init__("spoof_wrench_data_logger")
        self.get_logger().info("Spoof wrench data logger started.")
        self.spoof_wrench_data_logger_ = self.create_subscription(Wrench, "/spoofer/wrench", self.data_callback, 10)
        self.spoof_wrench_data_logger_pub = self.create_publisher(Wrench, "/spoofer/wrench_filtered", 10)

    def data_callback(self, data: Wrench):
        t = time.time()

        fx2 = data.force.x
        fy2 = data.force.y
        fz2 = data.force.z
        tx2 = data.torque.x
        ty2 = data.torque.y
        tz2 = data.torque.z
        fdata = Wrench()

        self.afx = 0.25
        self.afy = 0.25
        self.afz = 0.3
        self.atx = 0.5
        self.aty = 0.5
        self.atz = 0.6

        fdata.force.x = self.afx*fx2 + ((1-self.afx)*self.fx1)
        self.fx1 = fdata.force.x
        fdata.force.y = self.afy*fy2 + ((1-self.afy)*self.fy1)
        self.fy1 = fdata.force.y
        fdata.force.z = self.afz*fz2 + ((1-self.afz)*self.fz1)
        self.fz1 = fdata.force.z

        fdata.torque.x = self.atx*tx2 + ((1-self.atx)*self.tx1)
        self.tx1 = fdata.torque.x
        fdata.torque.y = self.aty*ty2 + ((1-self.aty)*self.ty1)
        self.ty1 = fdata.torque.y         
        fdata.torque.z = self.atz*tz2 + ((1-self.atz)*self.tz1)
        self.tz1 = fdata.torque.z
        
        

        self.spoof_wrench_data_logger_pub.publish(fdata)
        #logger_string_force = "Force x: %08.3f  Force y: %08.3f  Force z: %08.3f" % (data.force.x,data.force.y,data.force.z)
        #logger_string_torque = "Torque x: %08.3f  Torque y: %08.3f  Torque z: %08.3f" % (data.torque.x,data.torque.y,data.torque.z)
        #self.get_logger().info(logger_string_force + "  " + logger_string_torque)


def main(args=None):
    rclpy.init(args=args)
    node = SpoofWrenchDataLoggerNode()
    rclpy.spin(node)
    rclpy.shutdown()</code></pre>
				</div>
			</div>


			<!-- Show Code for Live Lowpass Button -->
			<div id="codeModal2" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3

# If its not already there, add "<depend>geometry_msgs</depend>" and "<depend>scipy</depend>" to package.xml

# Add "ur5_ft300_data_logger = YOUR_PACKAGE_NAME.ur5_ft300_data_logger:main" to setup.py

import rclpy
import time
from rclpy.node import Node
from geometry_msgs.msg import WrenchStamped
import numpy as np
from scipy.signal import butter,filtfilt

class UR5FT300DataFilterNode(Node):

    data_raw_fx = np.zeros(3)
    data_lpf_fx = np.zeros(3)
    data_raw_fy = np.zeros(3)
    data_lpf_fy = np.zeros(3)
    data_raw_fz = np.zeros(3)
    data_lpf_fz = np.zeros(3)

    data_raw_tx = np.zeros(3)
    data_lpf_tx = np.zeros(3)
    data_raw_ty = np.zeros(3)
    data_lpf_ty = np.zeros(3)
    data_raw_tz = np.zeros(3)
    data_lpf_tz = np.zeros(3)

    msg = WrenchStamped()
    fx1 = msg.wrench.force.x
    fy1 = msg.wrench.force.y
    fz1 = msg.wrench.force.z
    tx1 = msg.wrench.torque.x
    ty1 = msg.wrench.torque.y
    tz1 = msg.wrench.torque.z

    afx = 1.0
    afy = 1.0
    afz = 1.0
    atx = 1.0
    aty = 1.0
    atz = 1.0

    def __init__(self):
        super().__init__("ur5_ft300_data_filter")
        self.get_logger().info("UR5 FT300 sensor data filter started.")
        self.ur5_ft300_data_exp_logger_ = self.create_subscription(WrenchStamped, "/ft300_data/raw", self.publish_exp_filtered_data, 10)
        self.ur5_ft300_data_exp_filter_pub = self.create_publisher(WrenchStamped, "/ft300_data/exp_filtered", 10)
        self.ur5_ft300_data_lowpass_logger_ = self.create_subscription(WrenchStamped, "/ft300_data/raw", self.publish_lowpass_filtered_data, 10)
        self.ur5_ft300_data_lowpass_filter_pub = self.create_publisher(WrenchStamped, "/ft300_data/lowpass_filtered", 10)


    def publish_exp_filtered_data(self, data: WrenchStamped):
        t = time.time()

        fx2 = data.wrench.force.x
        fy2 = data.wrench.force.y
        fz2 = data.wrench.force.z
        tx2 = data.wrench.torque.x
        ty2 = data.wrench.torque.y
        tz2 = data.wrench.torque.z
        fdata = WrenchStamped()

        self.afx = 0.25
        self.afy = 0.25
        self.afz = 0.2
        self.atx = 0.5
        self.aty = 0.5
        self.atz = 0.6

        fdata.wrench.force.x = self.afx*fx2 + ((1-self.afx)*self.fx1)
        self.fx1 = fdata.wrench.force.x
        fdata.wrench.force.y = self.afy*fy2 + ((1-self.afy)*self.fy1)
        self.fy1 = fdata.wrench.force.y
        fdata.wrench.force.z = self.afz*fz2 + ((1-self.afz)*self.fz1)
        self.fz1 = fdata.wrench.force.z

        fdata.wrench.torque.x = self.atx*tx2 + ((1-self.atx)*self.tx1)
        self.tx1 = fdata.wrench.torque.x
        fdata.wrench.torque.y = self.aty*ty2 + ((1-self.aty)*self.ty1)
        self.ty1 = fdata.wrench.torque.y         
        fdata.wrench.torque.z = self.atz*tz2 + ((1-self.atz)*self.tz1)
        self.tz1 = fdata.wrench.torque.z

        fdata.header.stamp = self.get_clock().now().to_msg()
        
        self.ur5_ft300_data_exp_filter_pub.publish(fdata)


    def publish_lowpass_filtered_data(self, data: WrenchStamped):

        fx = data.wrench.force.x
        fy = data.wrench.force.y
        fz = data.wrench.force.z
        tx = data.wrench.torque.x
        ty = data.wrench.torque.y
        tz = data.wrench.torque.z
        fdata = WrenchStamped()

        T = 1/100 # Sampling time in seconds

        # wc is cutoff frequency
        
        fx_wc = 30
        fy_wc = 30
        fz_wc = 30
        tx_wc = 30
        ty_wc = 30
        tz_wc = 30

        # dr is dampening ratio

        fx_dr = 1
        fy_dr = 1
        fz_dr = 1
        tx_dr = 1
        ty_dr = 1
        tz_dr = 1

        self.data_raw_fx, self.data_lpf_fx = self.lpf_filt(self.data_raw_fx, self.data_lpf_fx, fx_wc, fx_dr, T, fx)
        self.data_raw_fy, self.data_lpf_fy = self.lpf_filt(self.data_raw_fy, self.data_lpf_fy, fy_wc, fy_dr, T, fy)
        self.data_raw_fz, self.data_lpf_fz = self.lpf_filt(self.data_raw_fz, self.data_lpf_fz, fz_wc, fz_dr, T, fz)
        self.data_raw_tx, self.data_lpf_tx = self.lpf_filt(self.data_raw_tx, self.data_lpf_tx, tx_wc, tx_dr, T, tx)
        self.data_raw_ty, self.data_lpf_ty = self.lpf_filt(self.data_raw_ty, self.data_lpf_ty, ty_wc, ty_dr, T, ty)
        self.data_raw_tz, self.data_lpf_tz = self.lpf_filt(self.data_raw_tz, self.data_lpf_tz, tz_wc, tz_dr, T, tz)

        fdata.wrench.force.x = self.data_lpf_fx[0]
        fdata.wrench.force.y = self.data_lpf_fy[0]
        fdata.wrench.force.z = self.data_lpf_fz[0]
        fdata.wrench.torque.x = self.data_lpf_tx[0]
        fdata.wrench.torque.y = self.data_lpf_ty[0]
        fdata.wrench.torque.z = self.data_lpf_tz[0]

        self.ur5_ft300_data_lowpass_filter_pub.publish(fdata)


    def lpf_filt(self, raw, lpf, wc, dr, T, new_sample):

        raw = [new_sample, raw[0], raw[1]]
        lpf[2] = lpf[1]
        lpf[1] = lpf[0]
        den = 1/(T*T*wc*wc+4*T*dr*wc+4)
        lpf[0] = den*(T*T*wc*wc*raw[0] + 2*T*T*wc*wc*raw[1] + T*T*wc*wc*raw[2] 
                                    - (2*T*T*wc*wc-8)*lpf[1] - (T*T*wc*wc-4*dr*T*wc+4)*lpf[2])
        return raw, lpf

def main(args=None):
    rclpy.init(args=args)
    node = UR5FT300DataFilterNode()
    rclpy.spin(node)
    rclpy.shutdown()</code></pre>
				</div>
			</div>

			<!-- Show UR5 Connect Code -->
			<div id="codeModal3" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3

# If its not already there, add "<depend>geometry_msgs</depend>" and "<depend>socket</depend>" to package.xml

# Add "ur5_ft300_sensor_connect = YOUR_PACKAGE_NAME.ur5_ft300_sensor_connect:main" to setup.py

import rclpy
from rclpy.node import Node
import numpy as np
from geometry_msgs.msg import WrenchStamped
import socket

class UR5_FT300_Sensor_Connect(Node):

    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

    def __init__(self):

        super().__init__("ur5_ft_sensor")
        self.get_logger().info("UR5 ft sensor reader started.")

        self.ft_sensor_pub = self.create_publisher(WrenchStamped, "/ft300_data/raw", 10)

        HOST = '192.168.1.9' # IP address of the ur5
        PORT = 63351 # A port of the ur5
        publish_zeros_on_error = False

        try:

            self.get_logger().info("Connecting to " + HOST)
            self.s.connect((HOST,PORT))
            self.s.settimeout(5.0)
            self.get_logger().info("Connection established")
            self.timer = self.create_timer(1/100, self.publish_ft300_data) # Runs the publish_ft300_data function at 100Hz

        except Exception as e:

            self.get_logger().info(f"No Connection: Error Message:\t {e}")

    def publish_ft300_data(self):

        try:

            data = str(self.s.recv(1024))

            if data:

                data = data.split(')')[-2]
                data = data.replace("(","")
                data = data.replace(" ","")
                data = data.replace("b'","")
                data = data.split(",")
                data = np.array([float(val) for val in data])

                msg = WrenchStamped()
                msg.wrench.force.x = data[0]
                msg.wrench.force.y = data[1]
                msg.wrench.force.z = data[2]
                msg.wrench.torque.x = data[3]
                msg.wrench.torque.y = data[4]
                msg.wrench.torque.z = data[5]

                self.ft_sensor_pub.publish(msg)

            else:

                self.get_logger().info(f'empty: {data}')

        except Exception as e:

            self.get_logger().info(f'n\nread error \n\t| {e} \n {data}\n\n')
    

def main(args=None):

    rclpy.init(args=args)
    node = UR5_FT300_Sensor_Connect()
    rclpy.spin(node)
    rclpy.shutdown()</code></pre>
				</div>
			</div>

			<!-- Show PX4 Connect Code -->
			<div id="codeModal4" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3

# CODE REQUIRES the following ROS2 workspaces to operate:
#   Micro-XRCE-DDS-Agent
#   PX4-Autopilot
#   ws_sensor_combined

# MAKE SURE THAT MicroXRCE Agent IS RUNNING!
#   If it isn't, run "MicroXRCEAgent udp4 -p 8888" in separate terminal
#   For connecting to a real drone, run "sudo MicroXRCEAgent serial --dev /dev/ttyUSB0 -b 921600"

# Add "<depend>px4_msgs</depend>" to package.xml

# Add "px4_motor_test7 = YOUR_PACKAGE_NAME.px4_motor_test7:main" to setup.py

# !WARNING!

# NOT SAFE TO FLY WITH

# KILL SWITCH ONLY WORKS IF HELD DOWN WHILE RUNNING THIS CODE

import rclpy
import time
import getopt, sys
import numpy as np
from rclpy.node import Node
from rclpy import qos
from px4_msgs.msg import VehicleCommand

class PX4MotorTest7(Node):

    def __init__(self):

        super().__init__("px4_motor_test7")
        self.get_logger().info("PX4 Motor Test 7 Initialized.")

        grab_mt = np.zeros(6) # Creates an array with 6 elements, all equaling 0, and assigns it to grab_mt
        mt = np.zeros(6) # Creates an array with 6 elements, all equaling 0, and assigns it to mt

        # Remove 1st argument from the list of command line arguments
        argumentList = sys.argv[1:]
        
        # Options
        options = 'hm:t:'
        
        # Long options
        long_options = ["Help", "Motors_Thrust=", "Time="]

        t=0 # If you don't give t an assigned value, it may have trouble connecting
        
        try:
            # Parsing argument
            arguments, values = getopt.getopt(argumentList, options, long_options)
            
            # checking each argument
            for currentArgument, currentValue in arguments:
        
                if currentArgument in ("-h", "--Help"): # If the user inputs -h or --Help
                    print ("-h --Help   Displays help\n")
                    print ("\n-m --Motors_thrust   Used to set the thrust of each motor\n")
                    print ("            ex: -m 0.1,0.2,0.3,0.4,0.5,0.6\n")
                    print ("\n-t --Time   Time to run motors for in seconds\n")

                    
                elif currentArgument in ("-m", "--Motors_Thrust"): # If the user inputs -m or --Motors_Thrust
                    
                    grab_mt = sys.argv[2].split(',') # grabs the motor thrust values as an array of 6 strings

                    for k in range(0,6): # This for loop converts the string values from grab_mt to float values as an array in mt
                    
                        mt[k] = float(grab_mt[k])

                    for i in range(0,6): # This for loop checks if the values are from 0.0 to 1.0 and if there are 6 values

                        if mt[i] < 0.0 or mt[i] > 1.0:
                            print("Error, input range for motor thrust is from 0 to 1.")

                        if len(mt) < 6 or len(mt) > 6:

                            print("Error, must input 6 values, from 0 to 1, for motor thrust.")

                        else:

                            continue

                elif currentArgument in ("-t", "--Time"): # If the user inputs -t or --Time
                    
                    test_time = float(sys.argv[4])
                    t = test_time * 10

                
        except getopt.error as err:
            # output error, and return with an error code
            print (str(err))

        # Input delay in seconds
        time.sleep(2) # This delay allows the ROS bag that this code is meant to work with time to start up

        self.get_logger().info("Motor test started.")

        self.px4_command_pub = self.create_publisher(VehicleCommand, "/fmu/in/vehicle_command", qos.qos_profile_sensor_data)
        # If ros bag doesn't capture the vehicle command topic, try adding a custom qos profile
        #   This link might help: https://docs.ros.org/en/foxy/How-To-Guides/Overriding-QoS-Policies-For-Recording-And-Playback.html
        
        # This while loop is what runs the motors 
        while (t*10) > 0:

            self.timercallback(mt)
            t = t-1
            time.sleep(0.1)


        # Shuts off the motors exactly after t time
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1101.0, 0.0, 0.0) # motor 1
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1102.0, 0.0, 0.0) # motor 2
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1103.0, 0.0, 0.0) # motor 3
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1104.0, 0.0, 0.0) # motor 4
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1105.0, 0.0, 0.0) # motor 5
        self.publish_vehicle_command(310, 0.0, 1.0, 0.0, 0.0, 1106.0, 0.0, 0.0) # motor 6
        # This isn't needed, however, without the above commands, the motors would spin a bit longer then t time




    def timercallback(self, mt):

        # Format:
        # self.publish_vehicle_command(command, param1, param2, param3, param4, param5, param6, param7)
        # self.publish_vehicle_command(310, 0.25, 1.0, 0.0, 0.0, 1103.0, 0.0, 0.0)
        # 310 is the command value for testing actuators
        # param1 is mapped to the throttle percent
        #   Ex: if you want to run motors at 25% throttle, input 0.25 for param1
        # param5 is mapped to which motor is being tested plus 1100
        #   Ex: if testing motor 3, input 1103 for param5

        self.publish_vehicle_command(310, mt[0], 1.0, 0.0, 0.0, 1101.0, 0.0, 0.0) # motor 1
        self.publish_vehicle_command(310, mt[1], 1.0, 0.0, 0.0, 1102.0, 0.0, 0.0) # motor 2
        self.publish_vehicle_command(310, mt[2], 1.0, 0.0, 0.0, 1103.0, 0.0, 0.0) # motor 3
        self.publish_vehicle_command(310, mt[3], 1.0, 0.0, 0.0, 1104.0, 0.0, 0.0) # motor 4
        self.publish_vehicle_command(310, mt[4], 1.0, 0.0, 0.0, 1105.0, 0.0, 0.0) # motor 5
        self.publish_vehicle_command(310, mt[5], 1.0, 0.0, 0.0, 1106.0, 0.0, 0.0) # motor 6


    def publish_vehicle_command(self, command, param1, param2, param3, param4, param5, param6, param7):

        msg = VehicleCommand()
        msg.param1 = param1 
        msg.param2 = param2 
        msg.param3 = param3
        msg.param4 = param4
        msg.param5 = param5
        msg.param6 = param6
        msg.param7 = param7
        msg.command = command 
        msg.target_system = 1 
        msg.target_component = 1 
        msg.source_system = 1 
        msg.source_component = 1 
        msg.from_external = True 
        msg.timestamp = int(self.get_clock().now().nanoseconds / 1000)
        self.px4_command_pub.publish(msg)

        # Use this link to reference the vehicle command topic:
        #   https://docs.px4.io/main/en/msg_docs/VehicleCommand.html
        # In addition to this, you could use the mavlink inspector with QGC Daily Build to log messages and convert them to csv
        #   Use this link for the mavlink message reference: https://mavlink.io/en/messages/common.html#COMMAND_LONG



def main(args=None):
    rclpy.init(args=args)
    node = PX4MotorTest7()
    rclpy.spin(node)
    rclpy.shutdown()</code></pre>
				</div>
			</div>

			<!-- Show UR5 Connect and Filter Launcher Code Button -->
			<div id="codeModal4" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3

from launch import LaunchDescription
from launch_ros.actions import Node

def generate_launch_description():

    return LaunchDescription([
        
        Node(
            package = 'ur5_code',
            executable = 'ur5_ft300_sensor_connect',
        ),

        Node(
            package = 'ur5_code',
            executable='ur5_ft300_data_filter',
        )

    ])</code></pre>
				</div>
			</div>

			<!-- Show PX4 Control and ROS Bag Launcher Code Button -->
			<div id="codeModal5" class="modal">
				<div class="modal-content">
					<span class="close">&times;</span>
					<button class="copyBtn">Copy</button>
					<pre><code>#!/usr/bin/env python3

from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument, ExecuteProcess
from launch.substitutions import LaunchConfiguration


def generate_launch_description():

    m = LaunchConfiguration('motor_thrust')
    ti = LaunchConfiguration('test_time')
    f = LaunchConfiguration('file_location')

    m_launch_arg = DeclareLaunchArgument(
        'motor_thrust',
        default_value = '0,0,0,0,0,0'
    )

    t_launch_arg = DeclareLaunchArgument(
        'test_time',
        default_value = '1.5'
    )

    f_launch_arg = DeclareLaunchArgument(
        'file_location',
        default_value='~/ur5_hex_copter_data_store/test_default'
    )

    start_motor_test = ExecuteProcess(
        cmd = [[
            'ros2 ',
            'run ',
            'px4_stuff ',
            'px4_motor_test7 '
            '-m ',
            m,
            ' -t ',
            ti
        ]],
        shell=True
    )

    start_ros_bag = ExecuteProcess(
        cmd = [[
            'ros2 ',
            'bag ',
            'record ',
            '-o ',
            f,
            ' /ft300_data/raw /ft300_data/exp_filtered /ft300_data/lowpass_filtered '
            'fmu/in/vehicle_command ',
            '--qos-profile-overrides-path /home/jj/qos_settings/px4_reliability_override.yaml',
        ]],
        shell=True
    )

    return LaunchDescription([
        
        m_launch_arg,
        t_launch_arg,
        f_launch_arg,
        start_ros_bag,
        start_motor_test,

    ])</code></pre>
				</div>
			</div>

						
			<script>
			document.addEventListener("DOMContentLoaded", function () {
			// Open modal on button click
			document.querySelectorAll(".show-code-btn").forEach(btn => {
				btn.addEventListener("click", function (event) {
				event.preventDefault();
				const targetId = btn.getAttribute("data-target");
				const modal = document.getElementById(targetId);
				if (modal) modal.style.display = "block";
				});
			});

			// Close modal on click of 'X' or outside content
			document.querySelectorAll(".modal").forEach(modal => {
				modal.querySelector(".close").addEventListener("click", () => modal.style.display = "none");

				window.addEventListener("click", function (event) {
				if (event.target === modal) {
					modal.style.display = "none";
				}
				});
			});

			// Close modal on Escape key
			window.addEventListener("keydown", function (event) {
				if (event.key === "Escape") {
				document.querySelectorAll(".modal").forEach(modal => modal.style.display = "none");
				}
			});

			// Copy code to clipboard
			document.querySelectorAll(".copyBtn").forEach((copyBtn, index) => {
				copyBtn.addEventListener("click", function () {
				const codeBlock = copyBtn.parentElement.querySelector("code");
				const text = codeBlock.innerText;
				navigator.clipboard.writeText(text).then(() => {
					copyBtn.innerText = "Copied!";
					setTimeout(() => copyBtn.innerText = "Copy", 1000);
				});
				});
			});
			});
			</script>

			



	</body>
</html>